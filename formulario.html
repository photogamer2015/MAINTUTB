<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Generar PDF con Imagen</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<!-- Logo e imagen evidencia -->
<img id="logoUTB" src="logo.png" style="display: none;" />
<input type="file" id="evidenciaInput" accept="image/*" />
<br><br>
<button onclick="generarPDF()">Generar PDF</button>

<script>
  const { jsPDF } = window.jspdf;

  let evidenciaBase64 = "";

  // Convertir la imagen cargada a base64
  document.getElementById('evidenciaInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function (event) {
      evidenciaBase64 = event.target.result;
    };
    if (file) reader.readAsDataURL(file);
  });

  function generarPDF() {
    const doc = new jsPDF();

    // Datos simulados
    const nombre = "Juan Pérez";
    const rol = "Estudiante";
    const tipoFalla = "Filtración de agua";
    const descripcion = "Se reporta una filtración de agua en el techo del aula 204.";
    const codigoProducto = "INFRA-204";
    const solucion = "Sellar la grieta del techo con material impermeable.";
    const email = "juan@example.com";

    // Agregar LOGO
    const logo = document.getElementById("logoUTB");
    doc.addImage(logo, "PNG", 75, 10, 60, 20); // centrado arriba

    // CONTENIDO FORMAL
    doc.setFont("helvetica", "normal");
    doc.text(`Babahoyo, ${new Date().toLocaleDateString()}`, 20, 40);
    doc.setFont("helvetica", "bold");
    doc.text("PARA:", 20, 50);
    doc.setFont("helvetica", "normal");
    doc.text("Sr. Decano de la Universidad Técnica de Babahoyo", 35, 50);
    doc.setFont("helvetica", "bold");
    doc.text("Asunto:", 20, 60);
    doc.setFont("helvetica", "normal");
    doc.text("Reporte de Falla en Infraestructura", 40, 60);

    let y = 70;
    const salto = 7;
    doc.text(`Yo, ${nombre}, en calidad de ${rol.toLowerCase()}, reporto la siguiente falla:`, 20, y); y += salto;
    doc.text(`Tipo de Falla: ${tipoFalla}`, 20, y); y += salto;
    doc.text(`Descripción:`, 20, y); y += salto;
    doc.text(doc.splitTextToSize(descripcion, 170), 25, y); y += salto * 3;
    doc.text(`Código del Producto: ${codigoProducto}`, 20, y); y += salto;
    doc.text(`Solución sugerida:`, 20, y); y += salto;
    doc.text(doc.splitTextToSize(solucion, 170), 25, y); y += salto * 3;
    doc.text(`Correo de contacto: ${email}`, 20, y); y += salto * 2;

    // AGREGAR IMAGEN DE EVIDENCIA (si fue cargada)
    if (evidenciaBase64) {
      doc.text("Evidencia fotográfica:", 20, y);
      y += 5;
      doc.addImage(evidenciaBase64, 'JPEG', 20, y, 100, 75); // ajusta tamaño/posición
    }

    doc.save(`Reporte_Falla_UTB_${nombre}.pdf`);
  }
</script>
</body>
</html>
