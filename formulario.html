<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Generar PDF - iOS y Android</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background-color: #f9f9f9;
  }
  h1 {
    color: #003366;
  }
  button {
    font-size: 18px;
    padding: 12px 25px;
    background-color: #0055aa;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover {
    background-color: #003366;
  }
</style>
</head>
<body>

<h1>Generar PDF con jsPDF para iOS y Android</h1>
<button id="btnGenerarPDF">Generar PDF</button>

<script>
  // Función para convertir imagen URL a base64 (asíncrona)
  async function getImageBase64(url) {
    const response = await fetch(url, {mode: 'cors'});
    const blob = await response.blob();
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    });
  }

  document.getElementById('btnGenerarPDF').addEventListener('click', async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Texto formal para el PDF
    const introduccion = 
      `Para el Decano de la Universidad Técnica de Babahoyo:\n\n` +
      `Por medio de la presente, se presenta el informe técnico correspondiente a la gestión y análisis de fallas en la infraestructura universitaria.\n\n` +
      `Agradecemos su atención y quedamos atentos a cualquier comentario.\n\n`;

    const informe = 
      `Informe Técnico:\n\n` +
      `1. Descripción de la falla: Se detectó una interrupción en el sistema eléctrico de la facultad.\n` +
      `2. Fecha del reporte: 5 de julio de 2025.\n` +
      `3. Acciones realizadas: Se reemplazaron los fusibles y se verificaron los cables.\n` +
      `4. Estado actual: Solucionado y monitoreado.\n\n` +
      `Se recomienda realizar mantenimiento preventivo mensual.\n`;

    // Añadir texto al PDF con ajuste de líneas para que no se salga
    const marginLeft = 15;
    let currentHeight = 20;
    const lineHeight = 7;

    doc.setFontSize(12);
    // División del texto en líneas para que ajuste en página
    const splitIntro = doc.splitTextToSize(introduccion, 180);
    doc.text(splitIntro, marginLeft, currentHeight);
    currentHeight += splitIntro.length * lineHeight + 5;

    doc.setFontSize(11);
    const splitInforme = doc.splitTextToSize(informe, 180);
    doc.text(splitInforme, marginLeft, currentHeight);

    // Añadir logo (base64) al final
    try {
      // Cambia esta URL por la de tu logo con CORS habilitado
      const logoURL = 'https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Escudo_de_Babahoyo.svg/1200px-Escudo_de_Babahoyo.svg.png';
      const imgBase64 = await getImageBase64(logoURL);
      // Posición (x=150, y=250), tamaño 40x40 mm
      doc.addImage(imgBase64, 'PNG', 150, 250, 40, 40);
    } catch (error) {
      console.warn('No se pudo cargar la imagen del logo:', error);
    }

    // Descargar o abrir PDF
    doc.save('InformeTecnico_UTB.pdf');
  });
</script>

</body>
</html>

