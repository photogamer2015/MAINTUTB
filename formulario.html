<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte de Fallas UTB</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    form {
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #45a049;
    }
    small {
      display: block;
      text-align: center;
      color: #888;
    }
  </style>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    window.jspdf = window.jspdf || jspdf;
  </script>
</head>
<body>

<h2>Reporte de Fallas en Infraestructura (UTB)</h2>
<form id="reportForm">
  <label for="facultad">Facultad:</label>
  <input type="text" id="facultad" required>

  <label for="carrera">Carrera:</label>
  <input type="text" id="carrera" required>

  <label for="curso">Curso:</label>
  <input type="text" id="curso" required>

  <label for="nombre">Nombre y Apellido:</label>
  <input type="text" id="nombre" required>

  <label for="email">Correo Electrónico:</label>
  <input type="email" id="email" required>

  <label for="rol">Rol:</label>
  <select id="rol" required>
    <option value="Estudiante">Estudiante</option>
    <option value="Docente">Docente</option>
  </select>

  <label for="tipoFalla">Tipo de Falla:</label>
  <select id="tipoFalla" required>
    <option value="Electricidad">Electricidad</option>
    <option value="Agua">Agua</option>
    <option value="Infraestructura">Infraestructura</option>
    <option value="Tecnologías">Tecnologías</option>
    <option value="Mobiliario">Mobiliario</option>
  </select>

  <label for="descripcion">Descripción del Problema:</label>
  <textarea id="descripcion" required></textarea>

  <label for="frecuencia">Frecuencia:</label>
  <select id="frecuencia" required>
    <option value="Primera vez">Primera vez</option>
    <option value="Ocasionalmente">Ocasionalmente</option>
    <option value="Frecuente">Frecuente</option>
  </select>

  <label for="afecta">¿Afecta actividades?</label>
  <select id="afecta" required>
    <option value="Sí">Sí</option>
    <option value="No">No</option>
  </select>

  <label for="fecha">Fecha del problema:</label>
  <input type="date" id="fecha" required>

  <label for="reportado">¿Reportado antes?</label>
  <select id="reportado" required>
    <option value="Sí">Sí</option>
    <option value="No">No</option>
  </select>

  <label for="solucion">Solución Sugerida:</label>
  <textarea id="solucion" required></textarea>

  <label for="comentario">Comentarios Adicionales:</label>
  <textarea id="comentario"></textarea>

  <button type="button" id="generatePDF">Generar PDF</button>
  <small>Tu reporte se descargará o abrirá según tu dispositivo.</small>
</form>

<script>
  document.getElementById("generatePDF").onclick = function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const nombre = document.getElementById("nombre").value;
    const facultad = document.getElementById("facultad").value;
    const carrera = document.getElementById("carrera").value;
    const curso = document.getElementById("curso").value;
    const email = document.getElementById("email").value;
    const rol = document.getElementById("rol").value;
    const tipoFalla = document.getElementById("tipoFalla").value;
    const descripcion = document.getElementById("descripcion").value;
    const frecuencia = document.getElementById("frecuencia").value;
    const afecta = document.getElementById("afecta").value;
    const fecha = document.getElementById("fecha").value;
    const reportado = document.getElementById("reportado").value;
    const solucion = document.getElementById("solucion").value;
    const comentario = document.getElementById("comentario").value;

    const texto = `
Babahoyo, ${new Date().toLocaleDateString()}

Señor(a) Decano(a)
Facultad de ${facultad}
Universidad Técnica de Babahoyo

Presente.-

De mi consideración:

Por medio de la presente, me permito poner en su conocimiento una falla presentada en la infraestructura de nuestra institución. El objetivo de este documento es informar formalmente los detalles del problema para su respectivo análisis y solución.

INFORME TÉCNICO:

• Nombre del reportante: ${nombre}
• Rol: ${rol}
• Carrera: ${carrera}
• Curso: ${curso}
• Correo electrónico: ${email}
• Tipo de falla: ${tipoFalla}
• Descripción: ${descripcion}
• Frecuencia: ${frecuencia}
• ¿Afecta actividades?: ${afecta}
• Fecha del problema: ${fecha}
• ¿Reportado antes?: ${reportado}
• Solución sugerida: ${solucion}
${comentario ? "• Comentario adicional: " + comentario : ""}

Agradezco de antemano la atención brindada a este reporte y quedo a la espera de una pronta solución.

Atentamente,

${nombre}
${rol} – UTB
    `;

    doc.setFontSize(12);
    const lines = doc.splitTextToSize(texto.trim(), 180);
    doc.text(lines, 15, 20);

    // Logo UTB (puedes cambiarlo por uno tuyo en base64 si lo deseas)
    const logoBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAMAAADvGU7dAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABgFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+POB/3AAAAX3RSTlMAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyAhIiMkJSYnKCkqKywtLi8wMTIzNDU2Nzg5Ojs8PT4/QkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWltcXV5fYGFiY2RlZ2hqa2xtbm9wcXJzdHV2d3h5ent8foCChIWGh4iJiouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaaoqaqrrK2ur7CxsrO0tba3uLm6u7y9vsDBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvb3N3e3+Dh4uPk5ebn6Onq6+zt7u/x8/T19vf4+fr7/P3+Z8NDxQAAAYlJREFUeNrs20dywyAMBdE0i4ihYCuIPnf//z3fZW4Fh1ZXfFg77PzNGKIoHnOKef6o6pHpIKUj9Fb2Q2xgAaB+Dx4UHLBj9QU3Thffr8LUJVDgUlJUMAnI3gWHB88tcAGx+kQQBlxuTPnCMg+d1Y0M8KacdkpiA3rEcJXDE8wd1H9X8XUzT2DPdAxG5ydQZn1wJ2gUtnxYwJK59Jqls9Oh98RHQroH0kL6HRk1xIHzgrorUO6FsWDpKeX6KYtH9nh1+kLtPWJmrYhbbthhUEjN5wQ9X9tIDNKpZRSnkbDPFwB+ybZDnGSJrScD4rN0S7sX4dYqAKeQ0Zk+x5VZHKj6wKPOAhSFRDLGhMDqJEPkDeZkZcBfczlFqRhRBEARBEARBEARBEARBEPwr/wAcGKmKVL9SgQAAAABJRU5ErkJggg==";

    doc.addImage(logoBase64, "PNG", 80, 265, 50, 20); // logo al pie

    const nombreArchivo = `${nombre.replace(/\s+/g, "_")}_reporte_UTB.pdf`;

    const userAgent = navigator.userAgent || navigator.vendor;
    const esIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;

    if (esIOS) {
      const blob = doc.output("blob");
      const url = URL.createObjectURL(blob);
      window.open(url, "_blank");
    } else {
      doc.save(nombreArchivo);
    }
  };
</script>

</body>
</html>


